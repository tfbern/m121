\input{setup.tex}
\subject{ICT Modul 121 -- Steuerungsaufgaben bearbeiten}
\title{Steuerung eines Arduino Uno Mikrokontrollers via WebSocket}
\subtitle{}
\author{Samuel Hess \\ 
\href{mailto:samuel.hess@tfbern.ch}{samuel.hess@tfbern.ch} \\ 
Technische Fachschule Bern}

\begin{document}
\maketitle

\newpage
% Inhaltsverzeichnis
\tableofcontents
\newpage

\section{Abstract}
In der vorliegenden Arbeit wurde untersucht, wie ein Arduino Uno über eine WebSocket-Verbindung gesteuert werden kann, während dieser im Sekundentakt Statusmeldungen versendet.

Der verwendete Funduino Uno R3\cite{lernset} verfügt über keine WLAN-Schnittstelle. Daher erfolgt die WebSocket-Kommunikation extern auf einem Gateway. Als Gateway wird ein Windows-PC verwendet. Arduino und Gateway sind per USB verbunden und kommunizieren über eine virtuelle serielle
Schnittstelle.

Das Ergebnis zeigt, dass eine Steuerung eines Arduinos per WebSocket problemlos möglich ist.  Die eingehenden Nachrichten müssen auf dem Arduino geparst werden. Dieses Parding ist einfacher, wenn das verwendete Austauschformt schlank gehalten wird. Deshalb wurde anstelle von JSON das URL Format verwendet.

\section{Einleitung}
In diesem Kapitel wird die Motivation erläutert und genaue Fragesellung definiert. Dann folgt eine kleine Übersichtsarbeit mit dazugehöriger Literaturrecherche.  

\subsection{Fragestellung}
Welche Möglichkeiten gibt es, einen Arduino Uno via Websocket zu steuern?

Während einer explorativen Online-Suche wurden einzelne Lösungen gefunden. Eine systematische Zusammenstellung der Möglichkeiten fehlt jedoch.

\subsection{Motivation}
Die Motivation für die vorliegende Arbeit ist die Beantwortung der nachfolgenden Fragestellung.
Weiter soll der Artikel interessierten Lesern als Einstiegslektüre diesen.

\subsection{Literatur-Review}
Zum Thema existiert diverse Fachliteratur unter anderem von Erik Bartmann\cite{bartmannArduino}\cite{bartmannESP8266}\cite{bartmannESP32}.

\subsubsection{Arduino mit integriertem WLAN}
Der Arduino Uno hat keine eingebaute WLAN Schnittstelle. Es gibt jedoch andere Arduino Modelle mit integriertem WLAN, wie z.B. der Arduino MKR1000.

\subsubsection{WLAN Erweiterung}
Mehrere Autoren berichten\cite{temperatureDashboard}\cite{websocketcommunication}, wie der Arduino mit dem dem WLAN Modul ESP8266 erweitert werden kann. 

\subsubsection{Serial Gateway}
Eine weitere Möglichkeit, ist behelfsweise einen PC als Serial Gateway einzusetzen.
Mangels kurzfristig verfügbarer Hardware wollen wir diese Option verfolgen.

\section{Experimenteller Teil}

\subsection{Informationsquellen}
Als Informationsquellen sind die Datenblätter zur jweiligen Hardware sowie die Manuals zu den einsesetzten Softwarekomponenten zu nennen.

\subsection{Prinzipskizze}

\subsection{Hardware}
Verwendet wurde das Lernset Nr. 8 von Funduino\cite{lernset}. Darin enthalten ist ein Funduino Uno. Weiter benötigen wir den Temparatursensor TMP36 und den Fotowiderstand.

\subsubsection{Anschluss der Sensoren}

\subsection{Software}

\subsubsection{Entwicklungsumgebung}
Zur Entwicklung wurde folgende Software eingesetzt.
\begin{itemize}
    \item Visual Studio Code\cite{vscode} mit der Erweiterung C/C++ IntelliSense\cite{intellisense}
    \item Arduino CLI\cite{arduinoCli}
    \item Git for Windows\cite{gitForWindows} und TortoiseGit\cite{tortoiseGit} 
  \end{itemize}
Nicht verwendet wurde die Arduino IDE. Windows verwendet den Standardtreiber \textit {usbser.sys} für den virtuellen COM Port. 

\subsubsection{Node Libraries}
Weiter wurde folgende NPM Packages eingesetzt:
\begin{itemize}
  \item WebSockets \cite{websockets}
  \item Express \cite{express}
  \item Chart.js \cite{chartjs}
  \item SerialPort \cite{serialPort}
\end{itemize}

\subsubsection{Arduino Libraries}
Weiter wurde folgende Arduino Libraries eingesetzt:
\begin{itemize}
  \item Arduino Library (Arduino.h) \cite{sprachreferenz}
  \item AVR Libc \cite{avrlibc}
\end{itemize}

\subsubsection{Arduino Sketch}
Der Quellcode befindet sich im Kapitel \ref{Arduino Sketch}.

\subsubsection{Serail Gateway}
Der Quellcode befindet sich im Kapitel \ref{Serial Gateway}.

\subsubsection{WebSocket Server}
Der Quellcode befindet sich im Kapitel \ref{WebSocket Server}.

\subsubsection{Web GUI}
Der Quellcode befindet sich im Kapitel \ref{Web Client}.

\section{Resultate}
Es hat sich gezeigt, dass ein Seriell-zu-Websocket-Gatway unter Node.js einfach zu implementieren ist. Über diesen Umweg kann der Arduino Uno ans Internet angebunden werden.

\section{Diskussion}

\section{Zusammenfassung}
Statt des Arduino Uno könnte ein Arduino MKR1000 verwendet werden. Dieser könnte kann auch an die Arduino Clound angebunden werden.
Ein weitere Option ist die Beschaffung einer WLAN Erweiterung wie das Modul ESP8266.

\section{Danksagung}
Ich danke den Lernenden der Klasse BINF2017A für die Zusammenarbeit.

\section{Interessenskonflikte}
Das Projekt wurde im Rahmen des Beruffachschulunterrichts durchgeführt und erhielt
keine externde Finanzierung. Demnach bestehen keien Interessenkonflikte.

% Literaturverzeichnis
\newpage
\section{Quellen}
\printbibliography[heading=subbibliography,title={Bücher},type=book]
\printbibliography[heading=subbibliography,title={Online},type=online]
\printbibliography[heading=subbibliography,title={Manuals},type=manual]
\printbibliography[heading=subbibliography,title={Software},type=misc]

% Anhang
\newpage
\appendix{}
\section{Quellcode}

\subsection{Arduino Sketch} \label{Arduino Sketch}
\lstinputlisting[language=c++]{../arduino/genericReadWrite/genericReadWrite.ino}
\subsubsection{Funktionen zur Statusausgabe}
\lstinputlisting[language=c++]{../arduino/genericReadWrite/status.cpp}
\subsubsection{Funktionen zur Steuerung}
\lstinputlisting[language=c++]{../arduino/genericReadWrite/control.cpp}

\newpage
\subsection{Serial Gateway} \label{Serial Gateway}
\lstinputlisting[language=js]{../gateway/gateway.js}

\newpage
\subsection{WebSocket Server} \label{WebSocket Server}
\lstinputlisting[language=js]{../websocketserver/websocketserver.js}

\newpage
\subsection{Web Client} \label{Web Client}
\lstinputlisting[language=js]{../client/index.html}

\newpage
\section{Erstellung dieses Dokuments}
Dieses Dokument wurde mit LaTeX erstellt. Der Quellcode befindet sich in der Datei
\verb|_doc/paper.tex|. Die Quellensammlung befindet sich in der Datei \verb|_doc/quellen.tex| klk

\subsection{LaTeX Umgebung}
Dazu wurde TeX Live \cite{texlive} installiert. Dieses
Paket stellt zahlreiche Tools zur Verfügung, darunter  \verb|pdflatex|

\subsection{LaTeX Editor}
Als Editor wurde Visual Studio Code \cite{vscode} mit der Erweiterung LaTeX Workshop \cite{latexWorkshop} verwendet.

Das automatische Speichern kann in Visual Studio Code unter \verb|File -> Auto save| aktiviert werden. Mit \verb|Ctrl+Alt+V| wird die Vorschau des generierten PDFs aktiviert. Mit \verb|Alt+Z| kann der automatische Zeilenumbruch eingeschalten werden.

Vorteile gegenüber Microsoft Word sind die automatische Vervollständigung beim Schreiben, sowie die einfache Einbindung von Quellcode Listings wie in Anhang A.

Weitere Informationen zum Erstellen des Inhaltsverzeichnis und des Literaturverzeichnis finden sich unter \cite{inhaltsverzeichnis} und \cite{literaturverzeichnis}.

\subsection{LaTeX Pakete}
Wie in \verb|_doc/setup.tex| zu sehen, werden folgende Pakete verwendet.
\begin{itemize}
    \item babel -- Multilingual support for Plain TeX or LaTeX
    \item xcolor -- Driver-independent color extensions for LaTeX and pdfLaTeX
    \item listings -- Typeset source code listings using LaTeX
    \item biblatex -- Sophisticated Bibliographies in LaTeX
    \item csquotes -- Context sensitive quotation facilities
\end{itemize}
Diese Pakete sind im Lieferumfang von TeX Live dabei und müssen nicht speziell installiert werden.
\end{document}